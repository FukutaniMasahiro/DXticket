<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ja">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <title>課題検索 / 一覧</title>
    <style>
        body { font-family: system-ui, sans-serif; margin: 24px; }
        .container { max-width: 1080px; margin: 0 auto; }
        .toolbar { display: flex; gap: 12px; align-items: center; margin-bottom: 16px; }
        .toolbar input[type="text"], .toolbar select { padding: 8px; }
        table { width: 100%; border-collapse: collapse; }
        th, td { border-bottom: 1px solid #eee; text-align: left; padding: 8px; vertical-align: top; }
        th { background: #fafafa; }
        .title { font-weight: 600; }
        .btn { padding: 8px 12px; background: #0f62fe; color: #fff; text-decoration: none; border: none; cursor: pointer; }
        .btn.secondary { background: #6c757d; }
        .actions { display: flex; gap: 8px; }
        .nowrap { white-space: nowrap; }
        .desc { color: #444; font-size: 0.92em; }
    </style>
    <script>
        function filter() {
            const q = document.getElementById('q').value.toLowerCase();
            const status = document.getElementById('statusFilter').value;
            const rows = document.querySelectorAll('#list tbody tr');
            rows.forEach(r => {
                const title = r.querySelector('.title').innerText.toLowerCase();
                const desc = r.querySelector('.desc').innerText.toLowerCase();
                const proposer = r.querySelector('.proposer').innerText.toLowerCase();
                const st = r.getAttribute('data-status');
                const okText = !q || title.includes(q) || desc.includes(q) || proposer.includes(q);
                const okStatus = !status || status === st;
                r.style.display = (okText && okStatus) ? '' : 'none';
            });
        }
    </script>
</head>
<body>
<div class="container">
    <h1>課題検索 / 一覧</h1>
    <div class="toolbar">
        <a class="btn" th:href="@{/issues/new}">新規登録</a>
        <input id="q" type="text" placeholder="フリーワード（タイトル/概要/提案者）" th:value="${q}" oninput="filter()"/>
        <select id="statusFilter" onchange="filter()">
            <option value="">全てのステータス</option>
            <option th:each="s : ${statuses}" th:value="${s}" th:text="${s}"></option>
        </select>
    </div>

    <table id="list">
        <thead>
        <tr>
            <th class="nowrap">チケットID</th>
            <th class="nowrap">発行日</th>
            <th>課題名 / 課題概要</th>
            <th class="nowrap">提案者</th>
            <th class="nowrap">ステータス</th>
            <th class="nowrap">操作</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="i : ${issues}" th:attr="data-status=${i.status}">
            <td class="nowrap" th:text="${i.id}"></td>
            <td class="nowrap" th:text="${i.issueDate}"></td>
            <td>
                <div class="title" th:text="${i.title}"></div>
                <div class="desc" th:text="${i.description}"></div>
            </td>
            <td class="proposer" th:text="${i.proposer}"></td>
            <td th:text="${i.status}"></td>
            <td class="actions">
                <a class="btn secondary" th:href="@{'/issues/' + ${i.id} + '/edit'}">編集</a>
                <form th:action="@{'/issues/' + ${i.id} + '/delete'}" method="post" style="display:inline">
                    <button class="btn secondary" type="submit" onclick="return confirm('削除してよろしいですか？')">削除</button>
                </form>
            </td>
        </tr>
        </tbody>
    </table>
</div>
</body>
</html>


